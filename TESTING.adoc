= Testing locally

== Check out the following repositories:

- https://github.com/gesundheitscloud/cov-survey[Survey Service]
- https://github.com/gesundheitscloud/survey-data[Survey Data]
- https://github.com/gesundheitscloud/consent-management[Consent Service ]
- https://github.com/gesundheitscloud/consent-documents[Consent Documents ]
- https://github.com/gesundheitscloud/cov-donation[Donation Service ]

== Run the services locally

=== Pre requirements

    Install and run local docker service.
    If you have problem with the `make build` command try adding the following lines to the `.gitconfig` file:
    Enforce SSH
    [url “ssh://git@github.com/“]
        insteadOf = https://github.com/
    [url “ssh://git@gitlab.com/“]
        insteadOf = https://gitlab.com/
    [url “ssh://git@bitbucket.org/“]
        insteadOf = https://bitbucket.org/

=== Survey service

- cov-survey: `make build`
- cov-survey: `make docker-database`
- cov-survey: `make run`
- survey-data: `make upload`

=== Consent service

- consent-management: `make build`
- consent-management: `make docker-database`
- consent-management: `make run`
- consent-documents: `make upload`

=== Donation service

- cov-donation: `make build`
- cov-donation: `make docker-database`
- cov-donation: `make run-api`
- cov-donation: `make run-uploader`

=== Runing tests

in the `data-donation-sdk/commonTest/kotlin/care/data4life/datadonation/integration` folder +
you can find the tests to run +
You have to supply the user session token from dev environment (unfortunately no mocking at this time)

== Clean up

- consent-management: `make docker-database-delete`
- cov-survey: `make docker-database-delete`

== Helper script

There is a helper.sh in the root folder.
If you want to quickly start and stop everything feel free to use it.

=== Pre requirements.

- All folders are next to the current root in their original directory name
- Ran `make build` in every service's folder

=== Usage:

- `source helper.sh`
- `DD-start` - will stop and populate every service
- `DD-stop` - will stop and destroy every service and database
- `DD-restart` - Will stop clean and restart every service
